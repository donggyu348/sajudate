<!DOCTYPE html>
<html lang="ko">
<%- include('./../../common/header') %>
<body class="flex items-center justify-center min-h-screen bg-gray-100">
<div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm border border-gray-200 relative overflow-hidden">
  <div class="absolute top-0 left-0 right-0 h-1.5 bg-gradient-to-r from-rose-500 to-red-500"></div>
  <h2 class="text-xl font-semibold mb-2 text-center">회원탈퇴</h2>
  <p class="text-xs text-gray-500 leading-relaxed mb-4 text-center">탈퇴 시 계정은 비활성화(복구 불가) 처리됩니다.</p>
  <form id="deleteForm" class="space-y-4">
    <div>
      <label for="del-password" class="block text-sm font-medium text-gray-700">비밀번호 확인</label>
      <input id="del-password" type="password" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none" placeholder="비밀번호" />
    </div>

    <!-- 탈퇴 약관 시작 -->
    <div class="space-y-3 text-xs">
      <details class="border rounded-md px-3 py-2 bg-gray-50">
        <summary class="cursor-pointer font-medium text-sm">탈퇴 안내 (필수)</summary>
        <div class="mt-2 max-h-32 overflow-y-auto leading-relaxed text-gray-600 whitespace-pre-wrap">
사주마을 회원탈퇴 안내
탈퇴 즉시 로그인 및 서비스 이용이 불가합니다.
법령상 보관 의무가 있는 결제/거래 관련 최소 정보는 관련 법령 기준에 따라 보존됩니다.
재가입 시 기존 데이터(보고서, 기록 등)는 복구되지 않습니다.
악용/부정 이용 이력이 확인될 경우 재가입이 제한될 수 있습니다.
        </div>
      </details>
      <details class="border rounded-md px-3 py-2 bg-gray-50">
        <summary class="cursor-pointer font-medium text-sm">개인정보 처리 관련 (필수)</summary>
        <div class="mt-2 max-h-32 overflow-y-auto leading-relaxed text-gray-600 whitespace-pre-wrap">
탈퇴 후 처리되는 개인정보 안내
- 즉시 삭제: 로그인 자격 증명(비밀번호 해시, 세션)
- 지연/보관: 결제 및 회계 관련 내역 (전자상거래 등 소비자 보호에 관한 법률 등 관련 법령 기간)
- 보존 목적: 법령 준수, 분쟁 대응, 부정 사용 방지

법정 보관 기간 경과 후 안전하게 파기됩니다.
        </div>
      </details>
      <label class="flex items-start space-x-2">
        <input id="withdraw-terms-check" type="checkbox" class="mt-1 checkbox checkbox-sm" />
        <span class="text-gray-700 leading-4">(필수) 위 탈퇴 안내 및 개인정보 처리 내용을 모두 확인하고 동의합니다.</span>
      </label>
    </div>
    <!-- 탈퇴 약관 끝 -->

    <button id="deleteBtn" type="button" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-md text-sm font-semibold">탈퇴하기</button>
    <a href="/saju" class="block w-full text-center text-sm text-gray-500 hover:underline">취소하고 돌아가기</a>
  </form>
</div>
</body>
<script>
  $(function(){
    $('#deleteBtn').on('click', function(e){
      e.preventDefault();
      const pw = $('#del-password').val();
      const agree = $('#withdraw-terms-check').is(':checked');
      if(!pw){ alert('비밀번호를 입력해주세요.'); return; }
      if(!agree){ alert('탈퇴 약관에 동의해야 합니다.'); return; }
      if(!confirm('정말 탈퇴하시겠습니까?\n이 작업은 되돌릴 수 없습니다.')) return;
      $.post('/user/delete', { password: pw, termsAgree: 'Y' })
        .done(function(){ alert('탈퇴가 완료되었습니다.'); window.location.href = '/saju'; })
        .fail(function(xhr){ alert(xhr.responseJSON?.error || '서버 오류'); });
    });
  });
</script>
</html>

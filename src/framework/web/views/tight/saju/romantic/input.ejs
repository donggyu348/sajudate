<!DOCTYPE html>
<html lang="ko">
<%- include('./../../common/header') %>

<body>
 
<div class="flex flex-col w-full max-w-[480px] mx-auto">
    <div class="flex justify-center flex-col items-start justify-center">

        <div class="relative overflow-hidden w-full max-w-[480px] mx-auto">
            <div class="relative w-full" style="aspect-ratio: 9/16;">
                <img src="/assets/images/tight/romantic/input_background.png" alt="" class="absolute inset-0 w-full h-full object-cover" aria-hidden="true" />
                <form id="sajuForm" method="POST" action="/saju/romantic/result"
                      class="relative z-10 flex flex-col items-center justify-center px-4 py-6 ">

                    <div id="loading" class="hidden fixed inset-0 z-50 bg-black/40 flex flex-col items-center justify-center">
                        <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                        <p id="loading-title" class="mt-4 text-white text-sm font-medium">ì‚¬ì£¼ë¥¼ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤</p>
                        <p class="mt-4 text-white text-sm font-medium">[1~2ë¶„ ì •ë„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”]</p>
                    </div>

                    <input type="hidden" name="gender" id="genderInput" />
                    <input type="hidden" name="birthType" id="birthTypeInput" />

                    <h1 class=" text-2xl text-white font-bold mt-12 mr-48"></h1>
                    <div class="w-full space-y-1 mt-8 sm:mt-12 pr-2 pl-2">
                        <h2 class="text-sm text-white font-pretendard-regular mb-2">ì´ë¦„</h2>
                        <input class="w-full bg-white/40 input input-bordered focus:outline-none" name="name" type="text" value="" />
                    </div>
                    <div class="w-full space-y-1 mt-8 sm:mt-12 pr-2 pl-2">
                        <div class="w-full space-y-1">
                            <h2 class="text-sm text-white font-pretendard-regular mb-2">ì„±ë³„</h2>
                            <div class="flex justify-between space-x-4">
                                <button type="button" value="ë‚¨ì„±"
                                        class="gender-btn bg-white/40 w-auto flex-1 py-2 px-4 border outline-none rounded-md border border-gray-300 active:border-2 active:border-bluePrimary">
                                    ë‚¨ì„±
                                </button>
                                <button type="button" value="ì—¬ì„±"
                                        class="gender-btn bg-white/40 w-auto flex-1 py-2 px-4 border outline-none rounded-md border border-gray-300 active:border-2 active:border-bluePrimary">
                                    ì—¬ì„±
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="w-full space-y-1 mt-8 sm:mt-12 pr-2 pl-2">
                        <h2 class="text-sm text-white font-pretendard-regular mb-2">ìƒë…„ì›”ì¼</h2>
                        <div class="flex space-x-4">
                            <select name="birthType" id="birthTypeInputSelect"
                                    class="w-28 py-2 px-4 border outline-none rounded-md border border-gray-300 bg-white/40">
                                <option value="ì–‘ë ¥">ì–‘ë ¥</option>
                                <option value="ìŒë ¥">ìŒë ¥</option>
                            </select>
                            <input class="w-full py-2 px-4 border outline-none rounded-md bg-white/40"
                                   name="birthdate" type="text" maxlength="8" placeholder="YYYYMMDD"
                                   inputmode="numeric" pattern="[0-9]*" />
                        </div>
                    </div>
                    <div class="w-full space-y-1 mt-8 sm:mt-12 pr-2 pl-2">
                        <h2 class="text-sm text-white font-pretendard-regular mb-2">íƒœì–´ë‚œ ì‹œ</h2>
                        <select name="birthTime" class="w-full select select-bordered bg-white/40">
                        <option selected value="unknown">ëª¨ë¦„</option>
                            <option value="00">ì¡°ì/æœå­ (00:00~01:29)</option>
                            <option value="02">ì¶•/ä¸‘ (01:30~03:29)</option>
                            <option value="04">ì¸/å¯… (03:30~05:29)</option>
                            <option value="06">ë¬˜/å¯ (05:30~07:29)</option>
                            <option value="08">ì§„/è¾° (07:30~09:29)</option>
                            <option value="10">ì‚¬/å·³ (09:30~11:29)</option>
                            <option value="12">ì˜¤/åˆ (11:30~13:29)</option>
                            <option value="14">ë¯¸/æœª (13:30~15:29)</option>
                            <option value="16">ì‹ /ç”³ (15:30~17:29)</option>
                            <option value="18">ìœ /é…‰ (17:30~19:29)</option>
                            <option value="20">ìˆ /æˆŒ (19:30~21:29)</option>
                            <option value="22">í•´/äº¥ (21:30~23:29)</option>
                            <option value="24">ì•¼ì/å¤œå­ (23:30~23:59)</option>
                        </select>
                    </div>
                    <div class="w-full mt-24 mb-8 pl-4 pr-4">
                        <button id="submitBtn" type="button" onclick="submitTightForm();"
                                class="w-full py-4 rounded-full text-sm font-bold text-gray-900 tracking-wide
    bg-gradient-to-b from-gray-100 to-gray-300 border border-gray-300 shadow-md shadow-inner hover:from-gray-200 hover:to-gray-400">
                            ë‹¤ìŒìœ¼ë¡œ
                        </button>
                    </div>
                </form>
            </div>
        </div>
</body>
<script>

  $(document).ready(function() {
    /* ì„±ë³„ ë²„íŠ¼ */
    $(".gender-btn").on("click", function() {
      $(".gender-btn").removeClass("active");
      $(this).addClass("active");
      $("#genderInput").val($(this).val());
    })
    ;

    /* ì–‘/ìŒë ¥ select ë™ê¸°í™” */
    $('#birthTypeInputSelect').on('change', function() {
      $('#birthTypeInput').val(this.value);
    }).trigger('change');
  });

  const submitTightForm = () => {
    const data = {
      name: $("input[name='name']").val()?.trim(),
      gender: $("#genderInput").val(),
      birthdate: $("input[name='birthdate']").val()?.trim(),
      birthTime: $("select[name='birthTime']").val(),
      birthType: $("#birthTypeInput").val()
    };

    const isValidBirthdate = /^\d{8}$/.test(data.birthdate);

   
  // ğŸ”¥ ê¸°ì¡´ nameVal â†’ data.name
  if (!data.name) {
    alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // ğŸ”¥ ê¸°ì¡´ genderVal â†’ data.gender
  if (!data.gender) {
    alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }

  if (!isValidBirthdate) {
    alert("ìƒë…„ì›”ì¼(YYYYMMDD)ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // ğŸ”¥ ê¸°ì¡´ birthTimeVal â†’ data.birthTime
  if (!data.birthTime) {
    alert("íƒœì–´ë‚œ ì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }


    // Show loading and prevent double submit
    $('#loading').removeClass('hidden');
    $('#submitBtn').prop('disabled', true).css('opacity', 0.6);

    $('#loading-title').text(`${data.name}ë‹˜ì˜ ì‚¬ì£¼ë¥¼ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤`);

    try { fbq('track', 'CompleteRegistration'); } catch (e) {}
    // Submit the form (no AJAX)
    $('#sajuForm').trigger('submit');
  };
</script>
</html>
